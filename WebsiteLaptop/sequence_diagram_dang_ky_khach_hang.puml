@startuml

hide footbox
skinparam defaultFontName Helvetica
skinparam defaultFontSize 12
skinparam maxMessageSize 500
skinparam ParticipantPadding 100

skinparam backgroundColor white
skinparam shadowing false
skinparam ActorBackgroundColor transparent
skinparam ParticipantBackgroundColor transparent
skinparam SequenceGroupBackgroundColor transparent
skinparam SequenceBoxBackgroundColor transparent
skinparam NoteBackgroundColor transparent

skinparam SequenceActivationBorderColor black
skinparam ActorBorderColor black
skinparam ParticipantBorderColor black
skinparam ArrowColor black
skinparam roundcorner 0

actor "Khách hàng" as CUSTOMER
participant "Frontend (User Web)" as FE
participant "RegisterAPIController" as API
database "Database" as DB

' Đăng ký
CUSTOMER -> FE : Nhập thông tin\n(FullName, Email, Phone, Password)\nNhấn "Đăng ký"
FE -> API : POST /api/Register
API -> API : ValidateRequest
API -> API : Check FullName not empty
API -> API : Check Email format (regex)
API -> API : Check Phone format (regex, 9-15 digits)
API -> API : Check Password (6-20 chars, contains letter + number)
alt Validation không hợp lệ
  API --> FE : 400 Bad Request + error message
  FE --> CUSTOMER : "Vui lòng kiểm tra lại thông tin"
else Validation hợp lệ
  API -> API : Trim + LowerCase email
  API -> DB : Check Email exists
  alt Email đã tồn tại
    API --> FE : 409 Conflict ("Email đã được đăng ký")
    FE --> CUSTOMER : "Email đã được sử dụng"
  else Email chưa tồn tại
    API -> DB : Check PhoneNumber exists
    alt PhoneNumber đã tồn tại
      API --> FE : 409 Conflict ("Số điện thoại đã được đăng ký")
      FE --> CUSTOMER : "Số điện thoại đã được sử dụng"
    else PhoneNumber chưa tồn tại
      API -> API : GenerateCustomerId()
      API -> DB : SELECT customers ORDER BY CustomerId DESC (get lastId)
      API -> API : Calculate nextId = "C{number+1:000}"
      API -> DB : INSERT Customers (CustomerId, CustomerName, Email, PhoneNumber, Username=email, Password, Active=true, Address="")
      API -> DB : SaveChanges
      API --> FE : 200 OK + CustomerDTO
      FE --> CUSTOMER : "Đăng ký thành công"\nRedirect to Login
    end
  end
end

@enduml

