@startuml

hide footbox
skinparam defaultFontName Helvetica
skinparam defaultFontSize 12
skinparam maxMessageSize 500
skinparam ParticipantPadding 100

skinparam backgroundColor white
skinparam shadowing false
skinparam ActorBackgroundColor transparent
skinparam ParticipantBackgroundColor transparent
skinparam SequenceGroupBackgroundColor transparent
skinparam SequenceBoxBackgroundColor transparent
skinparam NoteBackgroundColor transparent

skinparam SequenceActivationBorderColor black
skinparam ActorBorderColor black
skinparam ParticipantBorderColor black
skinparam ArrowColor black
skinparam roundcorner 0

actor "Chủ cửa hàng" as OWNER
participant "Frontend (Admin Web)" as FE
participant "ManageSupplierAPIController" as API
database "Database" as DB

' 1) Mở màn quản lý
OWNER -> FE : Chọn "Quản lý nhà cung cấp"
FE -> API : GET /api/admin/suppliers
API -> DB : SELECT suppliers (Include StockImports, filter, pagination)
DB --> API : supplierList
API --> FE : 200 OK + list
FE --> OWNER : Hiển thị danh sách

' 2) Thao tác: Thêm / Sửa / Xóa(ẩn) / Khôi phục
alt Thêm nhà cung cấp
  OWNER -> FE : Nhập thông tin\nNhấn "Lưu"
  FE -> API : POST /api/admin/suppliers
  API -> API : Validate SupplierName not empty
  API -> API : GenerateSupplierId()
  API -> DB : Check SupplierId exists
  alt Hợp lệ
    API -> DB : INSERT Suppliers (Active=true)
    API -> API : LogHistory("Thêm nhà cung cấp")
    API --> FE : 201 Created + SupplierDTO
    FE --> OWNER : Thông báo "Thành công"\nReload
  else Không hợp lệ
    API --> FE : 400 + errors
    FE --> OWNER : "Vui lòng nhập lại"
  end

else Cập nhật nhà cung cấp
  OWNER -> FE : Chọn nhà cung cấp\nSửa\nNhấn "Lưu"
  FE -> API : PUT /api/admin/suppliers/{id}
  API -> DB : SELECT supplier WHERE id (Include StockImports)
  API -> API : Validate SupplierName not empty
  alt Hợp lệ
    API -> DB : UPDATE Suppliers SET (SupplierName, PhoneNumber, Address, Email)
    API -> API : LogHistory("Cập nhật nhà cung cấp")
    API --> FE : 200 OK
    FE --> OWNER : "Thành công"\nReload
  else Không hợp lệ
    API --> FE : 400 + errors
    FE --> OWNER : "Vui lòng nhập lại"
  end

else Xóa nhà cung cấp (Ẩn)
  OWNER -> FE : Chọn Delete
  FE -> API : DELETE /api/admin/suppliers/{id}
  activate API
  API -> DB : SELECT supplier WHERE id
  API -> DB : UPDATE Suppliers SET Active=0
  API -> API : LogHistory("Xóa nhà cung cấp")
  API --> FE : 200 OK
  deactivate API
  FE --> OWNER : "Đã ẩn nhà cung cấp"\nReload

else Khôi phục nhà cung cấp
  OWNER -> FE : Chọn Restore
  FE -> API : POST /api/admin/suppliers/{id}/restore
  activate API
  API -> DB : SELECT supplier WHERE id
  API -> DB : UPDATE Suppliers SET Active=1
  API -> API : LogHistory("Khôi phục nhà cung cấp")
  API --> FE : 200 OK
  deactivate API
  FE --> OWNER : "Đã khôi phục nhà cung cấp"\nReload
end

FE --> OWNER : Hiển thị danh sách

@enduml

