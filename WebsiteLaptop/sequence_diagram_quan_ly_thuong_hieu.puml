@startuml

hide footbox
skinparam defaultFontName Helvetica
skinparam defaultFontSize 12
skinparam maxMessageSize 500
skinparam ParticipantPadding 100

skinparam backgroundColor white
skinparam shadowing false
skinparam ActorBackgroundColor transparent
skinparam ParticipantBackgroundColor transparent
skinparam SequenceGroupBackgroundColor transparent
skinparam SequenceBoxBackgroundColor transparent
skinparam NoteBackgroundColor transparent

skinparam SequenceActivationBorderColor black
skinparam ActorBorderColor black
skinparam ParticipantBorderColor black
skinparam ArrowColor black
skinparam roundcorner 0

actor "Chủ cửa hàng" as OWNER
participant "Frontend (Admin Web)" as FE
participant "ManageBrandAPIController" as API
database "Database" as DB

' 1) Mở màn quản lý
OWNER -> FE : Chọn "Quản lý thương hiệu"
FE -> API : GET /api/admin/brands
API -> DB : SELECT brands (Include Products, filter, pagination)
DB --> API : brandList
API --> FE : 200 OK + list
FE --> OWNER : Hiển thị danh sách

' 2) Thao tác: Thêm / Sửa / Xóa(ẩn) / Khôi phục
alt Thêm thương hiệu
  OWNER -> FE : Nhập thông tin\nNhấn "Lưu"
  FE -> API : POST /api/admin/brands
  API -> API : Validate BrandName not empty
  API -> API : GenerateBrandId()
  API -> DB : Check BrandId exists
  API -> DB : Check BrandName exists
  alt Hợp lệ
    API -> DB : INSERT Brands (Active=true)
    API -> API : LogHistory("Thêm thương hiệu")
    API --> FE : 201 Created + BrandDTO
    FE --> OWNER : Thông báo "Thành công"\nReload
  else Không hợp lệ
    API --> FE : 400 + errors
    FE --> OWNER : "Vui lòng nhập lại"
  end

else Cập nhật thương hiệu
  OWNER -> FE : Chọn thương hiệu\nSửa\nNhấn "Lưu"
  FE -> API : PUT /api/admin/brands/{id}
  API -> DB : SELECT brand WHERE id (Include Products)
  API -> API : Validate BrandName not empty
  API -> DB : Check BrandName exists (exclude current)
  alt Hợp lệ
    API -> DB : UPDATE Brands SET BrandName
    API -> API : LogHistory("Sửa thương hiệu")
    API --> FE : 200 OK
    FE --> OWNER : "Thành công"\nReload
  else Không hợp lệ
    API --> FE : 400 + errors
    FE --> OWNER : "Vui lòng nhập lại"
  end

else Xóa thương hiệu (Ẩn)
  OWNER -> FE : Chọn Delete
  FE -> API : DELETE /api/admin/brands/{id}
  activate API
  API -> DB : SELECT brand WHERE id (Include Products)
  API -> DB : UPDATE Brands SET Active=0
  loop For each product of brand
    API -> DB : UPDATE Products SET Active=0
  end
  API -> API : LogHistory("Xóa thương hiệu")
  API --> FE : 200 OK
  deactivate API
  FE --> OWNER : "Đã ẩn hãng và sản phẩm"\nReload

else Khôi phục thương hiệu
  OWNER -> FE : Chọn Restore
  FE -> API : POST /api/admin/brands/{id}/restore
  activate API
  API -> DB : SELECT brand WHERE id (Include Products)
  API -> DB : UPDATE Brands SET Active=1
  loop For each product of brand
    API -> DB : UPDATE Products SET Active=1
  end
  API -> API : LogHistory("Khôi phục thương hiệu")
  API --> FE : 200 OK
  deactivate API
  FE --> OWNER : "Đã khôi phục hãng và sản phẩm"\nReload
end

FE --> OWNER : Hiển thị danh sách

@enduml

