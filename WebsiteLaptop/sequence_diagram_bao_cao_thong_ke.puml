@startuml

hide footbox
skinparam defaultFontName Helvetica
skinparam defaultFontSize 12
skinparam maxMessageSize 500
skinparam ParticipantPadding 100

skinparam backgroundColor white
skinparam shadowing false
skinparam ActorBackgroundColor transparent
skinparam ParticipantBackgroundColor transparent
skinparam SequenceGroupBackgroundColor transparent
skinparam SequenceBoxBackgroundColor transparent
skinparam NoteBackgroundColor transparent

skinparam SequenceActivationBorderColor black
skinparam ActorBorderColor black
skinparam ParticipantBorderColor black
skinparam ArrowColor black
skinparam roundcorner 0

actor "Chủ cửa hàng" as OWNER
participant "Frontend (Admin Web)" as FE
participant "StatisticalReportAPIController" as API
database "Database" as DB

' 1) Mở màn báo cáo
OWNER -> FE : Chọn "Báo cáo thống kê"
FE -> API : GET /api/admin/statistical-report/overview
API -> DB : SELECT saleInvoices WHERE Status="Hoàn thành" (SUM TotalAmount)
API -> DB : SELECT saleInvoices (COUNT)
API -> DB : SELECT saleInvoiceDetails (SUM Quantity)
DB --> API : (totalRevenue, totalOrders, averageOrderValue, averageProductsPerOrder)
API --> FE : 200 OK + overview
FE --> OWNER : Hiển thị thống kê tổng quan

' 2) Các báo cáo chi tiết
alt Xem doanh thu theo tháng
  OWNER -> FE : Chọn "Doanh thu theo tháng"
  FE -> API : GET /api/admin/statistical-report/revenue-by-month?year
  API -> DB : SELECT saleInvoices WHERE Status="Hoàn thành" GROUP BY month
  DB --> API : revenueByMonth
  API --> FE : 200 OK + data
  FE --> OWNER : Hiển thị biểu đồ

else Xem top sản phẩm bán chạy
  OWNER -> FE : Chọn "Top sản phẩm"
  FE -> API : GET /api/admin/statistical-report/top-products?top
  API -> DB : SELECT saleInvoiceDetails WHERE Status="Hoàn thành" GROUP BY ProductId ORDER BY totalSold
  API -> DB : SELECT products (Include Brand) WHERE productId
  DB --> API : topProducts
  API --> FE : 200 OK + data
  FE --> OWNER : Hiển thị danh sách

else Xem đơn hàng theo trạng thái
  OWNER -> FE : Chọn "Đơn hàng theo trạng thái"
  FE -> API : GET /api/admin/statistical-report/orders-by-status
  API -> DB : SELECT saleInvoices GROUP BY Status
  DB --> API : ordersByStatus
  API --> FE : 200 OK + data
  FE --> OWNER : Hiển thị biểu đồ

else Xem tăng trưởng người dùng
  OWNER -> FE : Chọn "Tăng trưởng người dùng"
  FE -> API : GET /api/admin/statistical-report/user-growth
  API -> DB : SELECT customers (COUNT total, GROUP BY month)
  DB --> API : userGrowth
  API --> FE : 200 OK + data
  FE --> OWNER : Hiển thị biểu đồ

else Xem thống kê nhập hàng
  OWNER -> FE : Chọn "Thống kê nhập hàng"
  FE -> API : GET /api/admin/statistical-report/import-statistics
  API -> DB : SELECT stockImportDetails (SUM Quantity)
  API -> DB : SELECT stockImports (COUNT, SUM TotalAmount)
  DB --> API : importStatistics
  API --> FE : 200 OK + data
  FE --> OWNER : Hiển thị thống kê

else Xem thống kê tồn kho
  OWNER -> FE : Chọn "Thống kê tồn kho"
  FE -> API : GET /api/admin/statistical-report/stock-statistics
  API -> DB : SELECT productConfigurations (SUM Quantity, COUNT)
  DB --> API : stockStatistics
  API --> FE : 200 OK + data
  FE --> OWNER : Hiển thị thống kê

else Xem thống kê bảo hành
  OWNER -> FE : Chọn "Thống kê bảo hành"
  FE -> API : GET /api/admin/statistical-report/warranty-statistics
  API -> DB : SELECT warranties GROUP BY Type, Status
  DB --> API : warrantyStatistics
  API --> FE : 200 OK + data
  FE --> OWNER : Hiển thị thống kê

else Xem doanh thu theo thương hiệu
  OWNER -> FE : Chọn "Doanh thu theo thương hiệu"
  FE -> API : GET /api/admin/statistical-report/revenue-by-brand
  API -> DB : SELECT saleInvoiceDetails (Include Product.Brand) WHERE Status="Hoàn thành" GROUP BY BrandId
  DB --> API : revenueByBrand
  API --> FE : 200 OK + data
  FE --> OWNER : Hiển thị biểu đồ

else Xem top khách hàng
  OWNER -> FE : Chọn "Top khách hàng"
  FE -> API : GET /api/admin/statistical-report/top-customers?top
  API -> DB : SELECT saleInvoices WHERE Status="Hoàn thành" GROUP BY CustomerId ORDER BY totalSpent
  DB --> API : topCustomers
  API --> FE : 200 OK + data
  FE --> OWNER : Hiển thị danh sách

else Xem doanh số theo nhân viên
  OWNER -> FE : Chọn "Doanh số theo nhân viên"
  FE -> API : GET /api/admin/statistical-report/sales-by-employee
  API -> DB : SELECT saleInvoices WHERE Status="Hoàn thành" GROUP BY EmployeeId
  DB --> API : salesByEmployee
  API --> FE : 200 OK + data
  FE --> OWNER : Hiển thị biểu đồ

else Xem so sánh nhập/xuất
  OWNER -> FE : Chọn "So sánh nhập/xuất"
  FE -> API : GET /api/admin/statistical-report/import-vs-export?year
  API -> DB : SELECT stockImports GROUP BY month
  API -> DB : SELECT stockExports (Include SaleInvoice) GROUP BY month
  DB --> API : importVsExport
  API --> FE : 200 OK + data
  FE --> OWNER : Hiển thị biểu đồ
end

FE --> OWNER : Hiển thị báo cáo

@enduml

